"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.replacerWithPath = void 0;
function replacerWithPath(replacer, canBeFirstKey) {
    const paths = new WeakMap();
    return function (key, value) {
        const prefix = paths.get(this);
        const path = (prefix !== null && prefix !== void 0 ? prefix : '') + (key ? getKeyName(key, this, !prefix && canBeFirstKey) : '');
        if (isIterable(value))
            paths.set(value, path);
        return replacer.call(this, key, value, path);
    };
}
exports.replacerWithPath = replacerWithPath;
function isIterable(value) {
    return value === Object(value);
}
function getKeyName(key, obj, isFirstKey) {
    if (Array.isArray(obj))
        return `[${key}]`;
    if (/^[a-z0-9\$_]+$/i.test(key))
        return !isFirstKey ? `.${key}` : key;
    return `[${JSON.stringify(key)}]`;
}
